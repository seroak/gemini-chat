---
name: context-usage-tracker
description: >
  Rules, Skills, Sub-agent의 사용률을 추적하고 월간 분석 리포트를 생성하여
  컨텍스트 최적화를 지원하는 워크플로. "사용률 분석", "컨텍스트 분석",
  "Rule 사용률", "월간 리포트", "컨텍스트 최적화", "사용률 추적",
  "세션 기록", "사용률 기록" 요청 시 트리거.
---

# Context Usage Tracker

Rules, Skills, Sub-agent 사용률을 추적하고 분석하여 컨텍스트를 지속적으로 최적화.

---

## 추적 대상 탐색 (동적)

세션 기록·분석 시 아래 디렉토리를 **스캔**하여 최신 목록을 얻는다.
정적 목록을 유지하지 않으므로 Rule/Skill 추가·삭제 시 이 파일을 수정할 필요 없음.

### Rules 탐색

- **경로**: `.cursor/rules/*.mdc`
- **적용 방식 판별**: 각 `.mdc` 파일의 frontmatter에서 `alwaysApply`, `globs`, 둘 다 없으면 `manual` 확인
- **줄 수**: 파일 읽기 후 줄 수 카운트

### Skills 탐색

- **경로**: `.cursor/skills/*/SKILL.md`
- **본 스킬(`context-usage-tracker`) 제외**: 자기 자신은 추적 대상이 아니라 추적 도구
- **참조 파일 수**: 각 Skill의 `references/` 디렉토리 내 파일 수

### Sub-agent (고정 3종)

| 타입 | 용도 |
|------|------|
| `explore` | 코드베이스 탐색, 구조 파악 |
| `generalPurpose` | 복잡한 멀티스텝 조사 |
| `shell` | 명령어 실행, git 작업 |

---

## 워크플로 1: 세션 기록

사용자가 "세션 기록", "사용률 기록", "오늘 작업 기록" 요청 시 실행.

### 절차

1. **추적 대상 스캔**: `.cursor/rules/*.mdc`와 `.cursor/skills/*/SKILL.md`를 Glob으로 탐색하여 현재 Rule/Skill 목록 파악
2. 이번 세션의 **작업 요약** 정리 (작업 내용, 유형, 대략적 시간)
3. **Rules 사용 내역** 기록:
   - alwaysApply Rule은 항상 트리거됨 (유용 여부만 판단)
   - globs Rule은 작업 파일 기반으로 트리거 여부 판단
   - manual Rule은 사용자가 명시적으로 언급한 경우만 트리거
4. **Skills 사용 내역** 기록:
   - 이번 세션에서 SKILL.md를 읽은 Skill만 트리거로 기록
   - 트리거 방식 (auto/user) 구분
5. **Sub-agent 사용 내역** 기록:
   - Task tool 사용 시마다 기록
6. `docs/context-usage/logs/YYYY-MM.md`에 추가
   - 파일 없으면 템플릿 기반으로 새로 생성
   - 템플릿: [session-log-template.md](references/session-log-template.md) 참조

### 유용성 판단 기준

| 판정 | 기준 |
|------|------|
| ✅ 유용 | Rule/Skill 내용이 실제 코드 작성/의사결정에 영향을 줌 |
| ⬜ 무관 | 트리거됐지만 이번 작업과 관련 없었음 |
| ❌ 방해 | 잘못된 가이드를 주거나 불필요한 컨텍스트 차지 |

---

## 워크플로 2: 월간 분석

사용자가 "월간 리포트", "사용률 분석", "컨텍스트 분석" 요청 시 실행.

### 절차

1. 해당 월의 로그 파일 읽기 (`docs/context-usage/logs/YYYY-MM.md`)
2. **정량 분석** 수행:
   - Rule별 트리거율, 유용률, 효율 점수 계산
   - Skill별 사용 횟수, 완료율, 평균 유용성 계산
   - Sub-agent 타입별 사용 빈도, 성공률 계산
3. **정성 분석** 수행:
   - 사용률 낮은 항목의 원인 분류
   - 사용률 높은 항목의 성공 요인 분석
   - 이전 월 대비 트렌드 비교 (이전 리포트 존재 시)
4. **최적화 제안** 도출:
   - ROI 등급 산정 (A/B/C/D/F)
   - 항목별 구체적 액션 제안
5. `docs/context-usage/reports/YYYY-MM-report.md`에 저장
   - 템플릿: [monthly-report-template.md](references/monthly-report-template.md) 참조

### 핵심 지표

| 지표 | 계산 방법 | 의미 |
|------|-----------|------|
| **트리거율** | 트리거 세션 수 / 총 세션 수 × 100 | 얼마나 자주 로드되는가 |
| **유용률** | 유용 판정 수 / 트리거 수 × 100 | 로드됐을 때 실제 도움이 되는가 |
| **효율 점수** | 유용률 / 컨텍스트 비용(줄 수) | 토큰 대비 가치 |
| **ROI 등급** | 효율 점수 기반 A/B/C/D/F | 유지/최적화/삭제 판단 기준 |
| **트렌드** | 이번 달 vs 지난 달 사용률 변화 | 사용 추이 |

### ROI 등급 기준

| 등급 | 조건 | 액션 |
|------|------|------|
| A (필수) | 유용률 80%+ & 트리거율 50%+ | 유지 |
| B (양호) | 유용률 60%+ & 트리거율 30%+ | 유지, 미세 조정 가능 |
| C (검토) | 유용률 40%+ 또는 전문 영역 | 내용 축소 또는 글로브 수정 검토 |
| D (최적화) | 유용률 40% 미만 | 대폭 수정 또는 적용방식 변경 |
| F (삭제) | 3개월 트리거 0% 또는 유용률 20% 미만 | 삭제 또는 다른 Rule에 병합 |

---

## 워크플로 3: 최적화 실행

월간 리포트의 제안을 바탕으로 실제 Rule/Skill을 수정.
상세 의사결정 가이드: [optimization-guide.md](references/optimization-guide.md) 참조

### 핵심 원칙

- 삭제 전 반드시 "이 기술을 프로젝트에서 사용 중인가?" 확인
- alwaysApply Rule 총량은 항상 70줄 이하 유지
- 개별 Rule은 50줄 이하 유지
- 변경 후 CONTEXT-MANAGEMENT-PLAN.md의 체크리스트 업데이트

### 최적화 액션 카탈로그

| 액션 | 설명 | 적용 시나리오 |
|------|------|---------------|
| **유지** | 변경 없이 유지 | ROI A/B 등급 |
| **축소** | Rule 줄 수 감소 | 유용률 낮은 부분 제거 |
| **글로브 수정** | 파일 패턴 변경 | 트리거율이 예상과 다를 때 |
| **적용방식 변경** | always↔globs↔manual | 컨텍스트 비용 최적화 |
| **병합** | 두 Rule을 하나로 | 항상 함께 사용되는 Rule |
| **분리** | 하나의 Rule을 둘로 | 일부만 유용한 Rule |
| **Skill화** | Rule → Skill 전환 | 절차적 내용이 Rule에 있을 때 |
| **삭제** | Rule/Skill 제거 | ROI F 등급 |
| **신규 생성** | 새 Rule/Skill 추가 | 반복 패턴 발견 |
